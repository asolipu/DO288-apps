### Dockerfile for deploying the frontend as a container image

history -c
lab review-dockerfile start
source /usr/local/etc/ocp4.config

oc login -u ${RHT_OCP4_DEV_USER} -p ${RHT_OCP4_DEV_PASSWORD} ${RHT_OCP4_MASTER_API}
cd ~/DO288-apps/todo-frontend
git checkout master

git checkout -b review-dockerfile
git push -u origin review-dockerfile

 oc new-project ${RHT_OCP4_DEV_USER}-review-dockerfile
 oc new-project ${RHT_OCP4_DEV_USER}-review-common
 
 vi Dockerfile // Optimize the provided Dockerfile
 // Build the To Do List front-end container image,
 sudo podman build -t . todo-frontend
 
 // Test the image
 sudo podman run --name testfrontend -d -p 8080:8080 todo-frontend
 
 curl -s localhost:8080 | grep h1
 sudo podman stop testfrontend
 sudo podman rm testfrontend
 git commit -a -m 'Fixed for OpenShift'
  git push
  cd ~
 sudo podman login -u ${RHT_OCP4_QUAY_USER} quay.io
 sudo skopeo copy containers-storage:localhost/todo-frontend docker://quay.io/{RHT_OCP4_QUAY_USER}/todo-frontend:latest
 oc project ${RHT_OCP4_DEV_USER}-review-common
   podman login -u ${RHT_OCP4_QUAY_USER} quay.io
  oc create secret generic quayio --from-file .dockerconfigjson=${XDG_RUNTIME_DIR}/containers/auth.json --type kubernetes.io/dockerconfigjson
  oc secrets link default quayio --for pull
  oc import-image todo-frontend --from quay.io/{RHT_OCP4_QUAY_USER}/todo-frontend:latest --confirm
  oc adm policy add-role-to-group system:registry system:serviceaccounts:${RHT_OCP4_DEV_USER}-review-dockerfile
  oc adm policy add-role-to-group system:image-puller system:serviceaccounts:${RHT_OCP4_DEV_USER}-review-dockerfile

 oc get is todo-frontend
 
 oc project ${RHT_OCP4_DEV_USER}-review-dockerfile
 oc new-app --name frontend -i ${RHT_OCP4_DEV_USER}-review-common/todo-frontend  -e BACKEND_HOST=api.example.com
 oc get pods
 oc expose svc/frontend
 oc get route/frontend
 FRONTEND_URL=$(oc get route/frontend -o jsonpath '{.spec.host}')
 curl -si $FRONTEND_URL | grep h1
 lab review-dockerfile grade
 lab review-dockerfile finish
